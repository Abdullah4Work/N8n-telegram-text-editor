name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: github-pages
    
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v3

      - name: ðŸ”§ Create config.js from Secrets
        run: |
          cat > config.js << 'EOF'
          // Auto-generated Configuration from GitHub Secrets
          // Generated: $(date)
          
          const CONFIG = {
              // AssemblyAI API Configuration
              ASSEMBLYAI: {
                  API_KEY: '${{ secrets.ASSEMBLYAI_API_KEY }}',
                  UPLOAD_URL: '${{ secrets.ASSEMBLYAI_UPLOAD_URL }}',
                  TRANSCRIPT_URL: '${{ secrets.ASSEMBLYAI_TRANSCRIPT_URL }}',
                  LANGUAGE_CODE: 'ar',
                  SETTINGS: {
                      speaker_labels: true,
                      punctuate: true,
                      format_text: true,
                      language_code: 'ar',
                      disfluencies: false
                  }
              },

              // JSONBin API Configuration
              JSONBIN: {
                  API_KEY: '${{ secrets.JSONBIN_API_KEY }}',
                  BASE_URL: '${{ secrets.JSONBIN_BASE_URL }}'
              },

              // Database Configuration (for API)
              DATABASE: {
                  API_URL: 'https://your-api-worker.workers.dev',
                  ENDPOINTS: {
                      GET_TEMPLATES: '/api/templates',
                      SAVE_VIDEO: '/api/save-video'
                  }
              },

              // Web App Configuration
              APP: {
                  WEB_APP_URL: '${{ secrets.WEB_APP_URL }}',
                  MAX_FILE_SIZE: 52428800,
                  ALLOWED_AUDIO_FORMATS: ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/m4a', 'audio/flac', 'audio/mp3'],
                  MAX_TEXT_LENGTH: 100000,
                  AUTO_SAVE_INTERVAL: 30000
              },

              // Telegram Configuration
              TELEGRAM: {
                  USER_ID: '${{ secrets.TELEGRAM_USER_ID }}'
              },

              // Templates Configuration
              TEMPLATES: {
                  COUNT: 4,
                  COLORS_PER_TEMPLATE: 4,
                  TOTAL_IMAGES: 16
              },

              // Series Colors
              SERIES_COLORS: [
                  '#667eea', '#f5576c', '#4facfe', '#43e97b',
                  '#fa709a', '#feca57', '#ff6348', '#2c3e50'
              ]
          };

          if (typeof module !== 'undefined' && module.exports) {
              module.exports = CONFIG;
          }

          if (typeof Object.freeze === 'function') {
              Object.freeze(CONFIG);
          }
          EOF

      - name: ðŸ“ Verify config.js
        run: |
          echo "âœ… config.js created successfully"
          ls -lh config.js

      - name: ðŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          publish_branch: gh-pages
          force_orphan: true
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: 'ðŸš€ Deploy from ${{ github.sha }}'

      - name: âœ… Deployment Complete
        run: |
          echo "ðŸŽ‰ Deployment completed!"
          echo "ðŸŒ URL: ${{ secrets.WEB_APP_URL }}"
